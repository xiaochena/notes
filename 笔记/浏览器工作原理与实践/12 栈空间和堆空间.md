# 12 | 栈空间和堆空间：数据是如何存储的？
[浏览器工作原理与实践](https://time.geekbang.org/column/article/129596)
## JavaScript 是什么类型的语言

**JavaScript 是一种弱类型的、动态的语言。**

- 弱类型，意味着你不需要告诉 JavaScript 引擎这个或那个变量是什么数据类型，JavaScript 引擎在运行代码的时候自己会计算出来。
- 动态，意味着你可以使用同一个变量保存不同类型的数据。

**我们把在使用之前就需要确认其变量数据类型的称为静态语言。相反地，我们把在运行过程中需要检查数据类型的语言称为动态语言。**

**支持隐式类型转换的语言称为弱类型语言，不支持隐式类型转换的语言称为强类型语言。**

![12 栈空间和堆空间-2023-09-25-22-21-05](/attachments/12%20栈空间和堆空间-2023-09-25-22-21-05.png)
JavaScript 中的一共有 8 种数据类型
![12 栈空间和堆空间-2023-09-25-22-26-45](/attachments/12%20栈空间和堆空间-2023-09-25-22-26-45.png)

## 栈空间和堆空间
在 JavaScript 的执行过程中， 主要有三种类型内存空间，分别是**代码空间、栈空间和堆空间**。其中的代码空间主要是存储可执行代码的,栈空间就是函数调用栈，是用来存储执行上下文的。

---
```javascript
function foo(){
  var a = "极客时间"
  var b = a
  var c = {name:"极客时间"}
  var d = c
}
foo()
```
当执行到第 3 行代码时，其调用栈的状态
![12 栈空间和堆空间-2023-09-25-22-28-54](/attachments/12%20栈空间和堆空间-2023-09-25-22-28-54.png)
变量 a 和变量 b 的值都被保存在执行上下文中，而执行上下文又被压入到栈中，所以也可以认为变量 a 和变量 b 的值都是存放在栈中的。

继续执行第 4 行代码，由于 JavaScript 引擎判断右边的值是一个引用类型，这时候处理的情况就不一样了，**JavaScript 引擎并不是直接将该对象存放到变量环境中，而是将它分配到堆空间里面，分配后该对象会有一个在“堆”中的地址，然后再将该数据的地址写进 c 的变量值，** 当 JavaScript 需要访问该数据的时候，是通过栈中的引用地址来访问的
![12 栈空间和堆空间-2023-09-25-22-51-42](/attachments/12%20栈空间和堆空间-2023-09-25-22-51-42.png)
### 结论 
**原始类型的数据值都是直接保存在“栈”中的，引用类型的值是存放在“堆”中的。
在 JavaScript 中，原始类型的赋值会完整复制变量值，而引用类型的赋值是复制引用地址。** 所以d=c的操作就是把 c 的引用地址赋值给 d
![12 栈空间和堆空间-2023-09-25-22-54-18](/attachments/12%20栈空间和堆空间-2023-09-25-22-54-18.png)

---
**”原始类型的数据是存放在栈中，引用类型的数据是存放在堆中的“**  这句话源于程序语言中一种常见的理论模型，用来解释变量和数据在运行时是如何存储和管理的。通常，它被用于描述一些具有静态类型系统和直接操作内存的语言，比如C++、Java等，但对于JavaScript这种动态类型的语言来说，情况会有所不同。

在许多编程语言中，"栈"通常用于存储原始类型的数据和引用类型的引用（地址），而"堆"用于存储引用类型的数据。原始数据通常包括整数、浮点数、布尔值、字符等。引用数据通常包括对象、数组和函数等。当你创建一个这样的原始类型的变量时，实际的值将被存储在栈内存中。而当你创建一个对象或数组等引用类型时，实例的值会被保存在堆内存中，而在栈内存中保存的只是这个堆内存的引用或地址。

**然而在JavaScript中，上述概念并不完全适用**。这是因为在JavaScript的黄金标准（ECMAScript）规定中，对于JavaScript的数据存放位置没有明确的规定，具体的数据存储取决于其实现方式。例如，在Google V8引擎中（它是Node.js和Chrome浏览器的底层JavaScript引擎），除了非常小的整数（称为 Smis）外，所有的数据类型，包括字符串，都存在堆内存中。

**对于JavaScript来讲，原始类型的数据和引用类型的数据不是严格按照“栈”和“堆”的概念来存放的，至少在 V8 这种实现方式下是如此。在 V8 中，除了非常小的整数被称为 Smis 之外，所有的数据类型，包括字符串，都在堆（Heap）上。**

**关于原始类型和引用类型的赋值。当我们为一个字符串变量赋值时，实际上是将常量池（constant pool）中的指针复制给这个变量，而非字符串的值。这就是所谓的字符串驻留（string interning）机制。** 所以，当你写 const a = 'foo'; const b = 'foo';，内存中并不会有两个 'foo' 字符串。
